import { Component } from '@angular/core';
import {QrService} from "../../services/qr.service";
import {ActivatedRoute, Router} from "@angular/router";
import {HttpErrorResponse} from "@angular/common/http";

@Component({
  selector: 'app-qr-payment',
  templateUrl: './qr-payment.component.html',
  styleUrls: ['./qr-payment.component.scss']
})
export class QrPaymentComponent {
  base64Image: string;// = 'â€°PNG  IHDRÃºÃº\bÅ½Ãj\fÃ‡IDATx^Ã­Ã’QÂ®\\9QÂ£w6;Å¸ÂÃµ, T@â‚¬HÃ©ÃŠ#Ã§Ã‹ Â©Ã«WÃ¹Ã§ÃŸÃ¿Ã¾Â§ÃªÃ¸OUÃ¿Â¯zÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—C>8Ã·?Ã¾Ã¹ÃÂ¾Ã¯â„¢ZÃ¦e-Ã¢ÃŽIÃ¼Å¾ÃzÃ®cÃŸ3ÂµÃŒÃŠZÃ„Ââ€œÃ¸=Â»ÃµÃœÃ‡Â¾gjâ„¢;â€ÂµË†;\'Ã±{vÃ«Â¹Â}ÃÃ”2w(kwNÃ¢Ã·Ã¬Ã–sÃ»Å¾Â©eÃ®PÃ–"Ã®Å“Ã„Ã¯Ã™Â­Ã§>Ã¶=SÃ‹ÃœÂ¡Â¬EÃœ9â€°ÃŸÂ³Ã›Ã§ÃŽÃŒâ€}oqy ÃŸ2Â¸CÂ¦Ã…ÃŒâ€â€œoÃ½Ã’sqy ÃŸ2Â¸CÂ¦Ã…ÃŒâ€â€œoÃ½Ã’sqy ÃŸ2Â¸CÂ¦Ã…ÃŒâ€â€œoÃ½Ã’sqy ÃŸ2Â¸CÂ¦Ã…ÃŒâ€â€œoÃ½Ã’sqy ÃŸ2Â¸CÂ¦Ã…ÃŒâ€â€œoÃ½Ã’sqy ÃŸ2Â¸CÂ¦Ã…ÃŒâ€â€œoÃ½rÃ©Â¹3cËœfÃˆÂ´Â²\fÂ±5Ã…Â¼â€¢e\fÂ³ÃƒÃŒn=Ã·Ã“ÃŠ2Ã„Ã–Ã³Vâ€“1ÃŒ3Â»ÃµÃœL+Ã‹[SÃŒ[YÃ†0;ÃŒÃ¬Ã–s_0Â­,ClM1oeÃƒÃ¬0Â³[Ã}ÃÂ´Â²\fÂ±5Ã…Â¼â€¢e\fÂ³ÃƒÃŒn=Ã·Ã“ÃŠ2Ã„Ã–Ã³Vâ€“1ÃŒ3Â»ÃµÃœÃ®[Ã„â„¢â€“Ã‰Âiâ„¢Å’avËœÃ™Â­Ã§Â®pâ€¡Ã˜"Â¶ÃˆÂ´Lâ€ LÃ‹d\fÂ³ÃƒÃŒn=wâ€¦;Ã„Â±EÂ¦e2dZ&cËœfvÃ«Â¹+Ãœ!Â¶Ë†-2-â€œ!Ã“2ÃƒÃ¬0Â³[Ã]Ã¡Â±Elâ€˜iâ„¢\fâ„¢â€“Ã‰fâ€¡â„¢ÃzÃ® wË†-bâ€¹LÃ‹dÃˆÂ´LÃ†0;ÃŒÃ¬Ã–sWÂ¸â€œ1Ã‹&â€œ1Ã‹&cËœfvÃ«Â¹+ÃœÃ‰Ëœeâ€œÃ‰Ëœeâ€œ1ÃŒ3Â»ÃµÃœÃ®dÃŒÂ²Ã‰dÃŒÂ²Ã‰fâ€¡â„¢ÃzÃ® w2fÃ™d2fÃ™d\fÂ³ÃƒÃŒn=wâ€¦;Â³l2Â³l2â€ Ã™afÂ·Å¾Â»Ã‚ÂÅ’Y6â„¢Å’Y6ÃƒÃ¬0Â³Ã›Â¥Ã§>%{Ã‹Â´Â²\fÂ±EÃ»Z&3Ã¥Ã¤[Â¿Ã´ÃœL+Ã‹[Â´Â¯e2SNÂ¾ÃµKÃ}ÃÂ´Â²\fÂ±EÃ»Z&3Ã¥Ã¤[Â¿Ã´ÃœL+Ã‹[Â´Â¯e2SNÂ¾ÃµKÃ}ÃÂ´Â²\fÂ±EÃ»Z&3Ã¥Ã¤[Â¿Ã´ÃœL+Ã‹[Â´Â¯e2SNÂ¾ÃµÃ‹Ã§~â€™Ã¹Å¾â€”3\'Ã±{vÃ«Â¹/Â¾Ã§Ã¥ÃŒIÃ¼Å¾ÃzÃ®â€¹Ã¯y9sÂ¿gÂ·Å¾Ã»Ã¢{^ÃŽÅ“Ã„Ã¯Ã™Â­Ã§Â¾Ã¸Å¾â€”3\'Ã±{vÃ«Â¹/Â¾Ã§Ã¥ÃŒIÃ¼Å¾Ã>8Ã·Ã›Ã°g Â¶ÃˆÂ´L&ÃƒebÃ«5=Ã·Â±C1-â€œÃ‰pâ„¢Ã˜zMÃ}Ã¬PLÃ‹d2\\&Â¶^Ã“s;Ã“2â„¢\fâ€”â€°Â­Ã—Ã´ÃœÃ‡Ã…Â´L&ÃƒebÃ«5=Ã·Â±C1-â€œÃ‰pâ„¢Ã˜zÃÃ§ÃŽÅ¸ÂÃ¶ÂµËœÂ¡Â©Ã–>|ÂLÃ‹dÂ¦Å“|Ã«â€”Å¾Ã»Ã‚TkÂ¾NÂ¦e2SNÂ¾ÃµKÃ}aÂªÂµ_\'Ã“2â„¢)\'ÃŸÃºÂ¥Ã§Â¾0Ã•Ãšâ€¡Â¯â€œiâ„¢ÃŒâ€â€œoÃ½Ã’s_ËœjÃ­ÃƒÃ—Ã‰Â´LfÃŠÃ‰Â·~Ã©Â¹/LÂµÃ¶Ã¡Ã«dZ&3Ã¥Ã¤[Â¿Ã¼5Ã§nËœâ€œÂ¡Â¬EÃ»v\fÃ®[4Ã•:Â¯Ã§Â¾ÃˆPÃ–Â¢};wË†-Å¡jÂÃ—s_d(kÃ‘Â¾Æ’;Ã„MÂµÃŽÃ«Â¹/2â€ÂµhÃŸÅ½Ãbâ€¹Â¦ZÃ§ÃµÃœÃŠZÂ´oÃ‡Ã Â±ESÂ­Ã³zÃ®â€¹\fe-ÃšÂ·cpâ€¡Ã˜Â¢Â©Ã–yWÅ“{â€“1ÃŒ3Ã„â„¢â€“Ã‰PÃ–2ÃŒÃ²TÃ¦=Ã·Eâ€ Ã˜"Ã“2ÃŠZâ€ YÅ¾ÃŠÃœ Ã§Â¾Ãˆ[dZ&CYÃ‹0Ã‹Sâ„¢Ã´Ãœbâ€¹LÃ‹d(kfy*sÆ’Å¾Ã»"Clâ€˜iâ„¢\fe-Ãƒ,OenÃs_dË†-2-â€œÂ¡Â¬eËœÃ¥Â©ÃŒ >8wÆ’>2-fÂ¾Ã…/Â¤Â©â€“avËœ!Â¶(kÃÃªÂ¹Ã…/Â¤Â©â€“avËœ!Â¶(kÃÃªÂ¹Ã…/Â¤Â©â€“avËœ!Â¶(kÃÃªÂ¹Ã…/Â¤Â©â€“avËœ!Â¶(kÃÃªÂ¹Ã…/Â¤Â©â€“avËœ!Â¶(kÃÃªÂ¹Ã…/Â¤Â©â€“avËœ!Â¶(kÃÃºÃ ÃœÃÃ›d\fÃ®ÃTâ€¹Ã˜"Ã“b&ÃƒebkÃŠÃ‰Â·~Ã©Â¹/â€“â„¢!Â¶Ë†-2-f2\\&Â¶Â¦Å“|Ã«â€”Å¾Ã»bâ„¢bâ€¹Ã˜"Ã“b&ÃƒebkÃŠÃ‰Â·~Ã©Â¹/â€“â„¢!Â¶Ë†-2-f2\\&Â¶Â¦Å“|Ã«â€”Å¾Ã»bâ„¢bâ€¹Ã˜"Ã“b&ÃƒebkÃŠÃ‰Â·~Ã©Â¹/â€“â„¢!Â¶Ë†-2-f2\\&Â¶Â¦Å“|Ã«â€”ÃŽ=3ÃµÃ‡Ã¢â„¢Vâ€“Ã‰pâ„¢Â²Ã–Â·Ã¸ÃÂ»ÃµÃœL+Ã‹dÂ¸LYÃ«[Ã¼Ã¦ÃzÃ®Â¦â€¢e2\\Â¦Â¬Ãµ-~Ã³n=Ã·Ã“ÃŠ2.SÃ–ÃºÂ¿yÂ·Å¾Ã»â€šieâ„¢\fâ€”)k}â€¹ÃŸÂ¼[Ã}ÃÂ´Â²Lâ€ Ã‹â€ÂµÂ¾Ã…oÃžÃ­Æ’sÃ§â€ºÃ˜"Â¶2fâ„¢â„¢\fâ€”â€°-bkÅ yk_fÂ·Å¾Ã»Ã¢-â€œÃ‰pâ„¢Ã˜"Â¶Â¦ËœÂ·Ã¶evÃ«Â¹/Ãž2â„¢\fâ€”â€°-bkÅ yk_fÂ·Å¾Ã»Ã¢-â€œÃ‰pâ„¢Ã˜"Â¶Â¦ËœÂ·Ã¶evÃ«Â¹/Ãž2â„¢\fâ€”â€°-bkÅ yk_fÂ·Å¾Ã»Ã¢-â€œÃ‰pâ„¢Ã˜"Â¶Â¦ËœÂ·Ã¶evÂ»Ã¢ÃœÂ³\fÃ­keâ„¢\fâ€”3Ã»â€“Ã‰Â¼e2Â»ÃµÃœU+Ã‹dÂ¸Å“Ã™Â·LÃ¦-â€œÃ™Â­Ã§Â®ZY&ÃƒÃ¥ÃŒÂ¾e2oâ„¢ÃŒn=wÃ•ÃŠ2.gÃ¶-â€œyÃ‹dvÃ«Â¹Â«Vâ€“Ã‰p9Â³oâ„¢ÃŒ[&Â³[Ã]ÂµÂ²Lâ€ Ã‹â„¢}Ã‹dÃž2â„¢ÃÂ®8wb+â€œ-â€º3Ã„Ã–>Ã¦Ãµâ€œâ„¢;ÃµÃœLâ€¹bkÃ³ÃºÃ‰ÃŒÂzÃ®Â¦Ã…\fÂ±ÂµÂyÃ½dÃ¦N=Ã·Ã“bâ€ Ã˜ÃšÃ‡Â¼~2sÂ§Å¾Ã»â€ši1ClÃ­c^?â„¢Â¹SÃ}ÃÂ´Ëœ!Â¶Ã¶1Â¯Å¸ÃŒÃœÃ©/>Ã·Â©Ã–Â¾epÃ‡0;Yâ€ Lâ€¹bÃ«Â¼Å¾Ã»Â¾epÃ‡0;Yâ€ Lâ€¹bÃ«Â¼Å¾Ã»Â¾epÃ‡0;Yâ€ Lâ€¹bÃ«Â¼Å¾Ã»Â¾epÃ‡0;Yâ€ Lâ€¹bÃ«Â¼Å¾Ã»Â¾epÃ‡0;Yâ€ Lâ€¹bÃ«Â¼Å¾Ã»Â¾epÃ‡0;Yâ€ Lâ€¹bÃ«Â¼KÃÂÂ¸cËœfË†-b+câ€“Â³\fâ„¢3Ã„eÂ­Y=Ã·Eâ€ Ã˜"Â¶2f9Ã‹Âi1ClQÃ–Å¡Ã•s_dË†-b+câ€“Â³\fâ„¢3Ã„eÂ­Y=Ã·Eâ€ Ã˜"Â¶2f9Ã‹Âi1ClQÃ–Å¡Ã•s_dË†-b+câ€“Â³\fâ„¢3Ã„eÂ­Y=Ã·Eâ€ Ã˜"Â¶2f9Ã‹Âi1ClQÃ–Å¡uÃ©Â¹â€º3SÃŒ[SÅ¡jâ€˜iâ„¢Å’ÃÂÃ´ÃœÃŒ[SÅ¡jâ€˜iâ„¢Å’ÃÂÃ´ÃœÃŒ[SÅ¡jâ€˜iâ„¢Å’ÃÂÃ´ÃœÃŒ[SÅ¡jâ€˜iâ„¢Å’ÃÂÃ´ÃœÃŒ[SÅ¡jâ€˜iâ„¢Å’ÃÂÃ´ÃœÃŒ[SÅ¡jâ€˜iâ„¢Å’ÃÂÃ¼5Ã§Å¾Ã¡2Â±Elâ€˜i1ClQÃ–ÃºÂ¿Ã¹Â¼Å¾Â»zâ€¹-2-fË†-ÃŠZÃŸÃ¢7Å¸Ã—sWoÂ±EÂ¦Ã…\fÂ±EYÃ«[Ã¼Ã¦Ã³zÃ®Ãª-Â¶ÃˆÂ´Ëœ!Â¶(k}â€¹ÃŸ|^Ã]Â½Ã…â„¢3Ã„eÂ­oÃ±â€ºÃÃ«Â¹Â«Â·Ã˜"Ã“bâ€ Ã˜Â¢Â¬Ãµ-~Ã³yÅ“Ã»mÃ¸Ãƒ[Ã„â„¢â€“Ã‰dÂ¸lpâ€¡Ã˜ÂºSÃ}Ã¬Ã§dâ€¹LÃ‹d2\\6Â¸ClÃÂ©Ã§>Ã¶sÂ²EÂ¦e2.Ãœ!Â¶Ã®Ã”sÃ»9Ã™"Ã“2â„¢\fâ€” Ã®[wÃªÂ¹ÂÃ½Å“lâ€˜iâ„¢Lâ€ Ã‹wË†Â­;ÃµÃœÃ‡~NÂ¶ÃˆÂ´L&ÃƒeÆ’;Ã„Ã–Â>8wÃ¾Â±NÃ¢Ã·[â€ Ã™1#Ã›1-â€œ!Â¶Ã®Ã”s_`Ã‹0;&cd;Â¦e2Ã„Ã–ÂzÃ®lfÃ‡dÅ’lÃ‡Â´Lâ€ Ã˜ÂºSÃ}Â-ÃƒÃ¬ËœÅ’â€˜Ã­Ëœâ€“Ã‰[wÃªÂ¹/Â°eËœâ€œ1Â²Ã“2bÃ«N=Ã·Â¶\fÂ³c2FÂ¶cZ&ClÃÃ©Å sgfJÃ¶â€“i1cËœÂ,CYâ€¹Â²Â¶Ë†Â­ÃzÃ®Â¦Ã…Å’avÂ²\fe-ÃŠvÃ˜"Â¶vÃ«Â¹/Ëœ3â€ Ã™Ã‰2â€Âµ(Ã›aâ€¹Ã˜ÃšÂ­Ã§Â¾`ZÃŒf\'Ã‹PÃ–Â¢lâ€¡-bkÂ·Å¾Ã»â€ši1cËœÂ,CYâ€¹Â²Â¶Ë†Â­ÃzÃ®Â¦Ã…Å’avÂ²\fe-ÃŠvÃ˜"Â¶vÂ»Ã´Ãœâ„¢1ÃŒÃŽT&Ãƒe2-fÂ¾â€¢}![Â»ÃµÃœÃƒLâ€ Ã‹dZÃŒ|+Ã»BÂ¶vÃ«Â¹â€¡â„¢\fâ€”Ã‰Â´ËœÃ¹VÃ¶â€¦lÃ­Ã–s3.â€œi1Ã³Â­Ã¬Ã™ÃšÂ­Ã§f2\\&Ã“bÃ¦[Ã™Â²Âµ[Ã=ÃŒdÂ¸LÂ¦Ã…ÃŒÂ·Â²/dkÂ·Å¾Ã»Xâ€ Ã˜:â€°ÃŸÃ³Â­Â¾Â°Ã§>â€“!Â¶NÃ¢Ã·|Ã«â€ /Ã¬Â¹ÂeË†Â­â€œÃ¸=ÃŸÂºÃ¡{Ã®cbÃ«$~ÃÂ·nÃ¸Ã‚Å¾Ã»Xâ€ Ã˜:â€°ÃŸÃ³Â­Â¾Â°Ã§>â€“!Â¶NÃ¢Ã·|Ã«â€ /Ã¬Â¹â€¡Â¸lËœÂ}Æ’;â€ÂµË†;Â»ÃµÃœC\\6ÃŒÃŽÂ¾Å’ÃÃŠZÃ„ÂÃzÃ®!.fg_Ã†Ã e-Ã¢ÃŽn=Ã·â€” Â³Â³/cpâ€¡Â²qgÂ·Å¾{Ë†Ã‹â€ Ã™Ã™â€”1Â¸CYâ€¹Â¸Â³[Ã=Ã„eÃƒÃ¬Ã¬Ã‹ÃœÂ¡Â¬EÃœÃ™Ã­Ã’sÅ¸bÃžÃŠ2Ã„â€“ÃÅ¡jÃ‘Tâ€¹Lâ€¹â„¢ÃzÃ®aâ€ Ã˜2Â¸CS-Å¡jâ€˜i1Â³[Ã=ÃŒ[whÂªES-2-fvÃ«Â¹â€¡bÃ‹Ã MÂµhÂªEÂ¦Ã…ÃŒn=Ã·0ClÃœÂ¡Â©MÂµÃˆÂ´ËœÃ™Â­Ã§fË†-Æ’;4Ã•Â¢Â©â„¢3Â»]qÃ®\'eÃŸÃƒVâ€ Ã‹Ã„Vâ€ Ã‹â€ÂµË†;wÃªÂ¹Â«Ã¯a+Ãƒeb+ÃƒeÃŠZÃ„Â;ÃµÃœÃ•Ã·Â°â€¢Ã¡2Â±â€¢Ã¡2e-Ã¢ÃŽÂzÃ®Ãª{Ã˜ÃŠpâ„¢Ã˜ÃŠpâ„¢Â²qÃ§N=wÃµ=leÂ¸LleÂ¸LYâ€¹Â¸sÂ§Å¾Â»ÃºÂ¶2\\&Â¶2\\Â¦Â¬EÃœÂ¹Ã“Ã§^Ãµâ€¢Å¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Â¤Ã§^Ã©Â¹Ã—CzÃ®ÃµÂÅ¾{=Ã¤ÃŠÂ²â€Ã Å¾Ã”ÂÆ’IENDÂ®B`â€š';
  qrId: number = 0;

  constructor(private qrService: QrService,
            private route: ActivatedRoute,
              private router: Router) {
    console.log("CONSTRUCTOR")
    this.base64Image = localStorage.getItem('qrCode');
    // localStorage.clear();

    this.route.params.subscribe(
      params => {
        this.qrId = params['id'];
      });
  }

  payQrCode() {
    this.qrService.payWithQRCode(this.base64Image, this.qrId).subscribe(
      res=>{
        console.log(res)
        console.log(res.headers)
        console.log(res.headers.get('Location'))
        // localStorage.clear();
        window.location.href = res.headers.get('Location')
      },(error: HttpErrorResponse) => {
      // if (error.status === 404) {
        // Handle the 404 error here
        this.router.navigateByUrl('/qr/save/' + this.qrId);
        console.log('Error 404: Not Found');
      // } else {
      //   // Handle other HTTP errors
      //   console.error('An error occurred:', error.error);
      // }
    });
  }
}
